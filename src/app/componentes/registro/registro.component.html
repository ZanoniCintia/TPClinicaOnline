<div class="form-container">
  <form (ngSubmit)="registrarse()">
    <h2>Registro</h2>

    <input type="text" placeholder="Nombre" [(ngModel)]="nombre" name="nombre" required />
    <input type="text" placeholder="Apellido" [(ngModel)]="apellido" name="apellido" required />
    <input type="number" placeholder="Edad" name="edad" [(ngModel)]="edad"  #edadRef="ngModel" required min="0"(blur)="0"
/>
<div *ngIf="edadRef.invalid && edadRef.touched" class="error-message">
  <small *ngIf="edadRef.errors?.['required']">La edad es obligatoria</small>
  <small *ngIf="edadRef.errors?.['min']">La edad no puede ser negativa</small>
 <small *ngIf="rolEspecialista && edad !== null && edad < 21">
  Debe tener al menos 21 años para registrarse como especialista
</small>

</div>
    <input type="text" placeholder="DNI" name="dni"  [(ngModel)]="dni" #dniRef="ngModel" required pattern="^[0-9]{8}$" (blur)="0"
/>
<div *gIf="dniRef.invalid && dniRef.touched" class="error-message">
  <small *ngIf="dniRef.errors?.['required']">El DNI es obligatorio</small>
  <small *ngIf="dniRef.errors?.['pattern']">El DNI debe tener exactamente 8 dígitos</small>
</div>

    <input type="email" placeholder="Email" [(ngModel)]="email" name="email" required />
    <input type="password" placeholder="Contraseña" [(ngModel)]="password" name="password" required />

    <!-- Roles -->
    <label><input type="checkbox" [(ngModel)]="rolPaciente" name="rolPaciente" (change)="rolEspecialista = rolPaciente ? false : rolEspecialista"/> Paciente
</label>

<label><input type="checkbox" [(ngModel)]="rolEspecialista" name="rolEspecialista" (change)="rolPaciente = rolEspecialista ? false : rolPaciente"/> Especialista
</label>

    <!-- Obra social solo si es paciente -->
    <input *ngIf="rolPaciente" type="text" placeholder="Obra Social" [(ngModel)]="obraSocial" name="obraSocial" />

    <!-- Especialidades solo si es especialista -->
    <div *ngIf="rolEspecialista">
      <label><strong>Especialidades:</strong></label>
      <div *ngFor="let esp of especialidades">
        <input 
          type="checkbox" 
          [value]="esp" 
          (change)="toggleEspecialidad(esp, $event)" 
          [checked]="especialidadesSeleccionadas.includes(esp)"
        /> {{ esp }}
      </div>

      <!-- Agregar nueva especialidad -->
      <input type="text" [(ngModel)]="nuevaEspecialidad" name="nuevaEspecialidad" placeholder="Nueva especialidad" />
      <button type="button" (click)="agregarEspecialidad()">Agregar Especialidad</button>
    </div>

    <!-- Imágenes -->
    <label>Imágenes de perfil:</label>
    <input type="file" (change)="seleccionarArchivo($event)" multiple accept="image/*" />

    <button type="submit">Registrarse</button>
    <!-- Mensaje de éxito -->
<div *ngIf="mensaje" style="color: green; margin-top: 10px;">
  {{ mensaje }}
</div>

<!-- Mensaje de error -->
<div *ngIf="error" style="color: red; margin-top: 10px;">
  {{ error }}
</div>


    <p class="success-message" *ngIf="mensaje">{{ mensaje }}</p>
    <p class="error-message" *ngIf="error">{{ error }}</p>
  </form>
</div>
