<div class="admin-container">
  <div class="user-info">
    <a class="logout-link" (click)="logout()">logout</a>
  </div>

  <h2>Panel de AdministraciÃ³n</h2>

  <!-- INFORMES DEL SISTEMA -->
  <div class="informes-panel">
    <h3>ğŸ“Š Informes del Sistema</h3>
    <div class="botones-informes">
      <button (click)="verLogIngresos()">ğŸ§¾ Log de Ingresos</button>
      <button (click)="verTurnosPorEspecialidad()">ğŸ“Œ Turnos por Especialidad</button>
      <button (click)="verTurnosPorDia()">ğŸ“… Turnos por DÃ­a</button>
      <button (click)="verTurnosPorMedico()">ğŸ‘¨â€âš•ï¸ Turnos por MÃ©dico</button>
      <button (click)="verTurnosFinalizados()">âœ… Finalizados por MÃ©dico</button>
    </div>

    <!-- LOG DE INGRESOS -->
    <div *ngIf="mostrarLogIngresos">
      <h4>ğŸ“˜ Log de ingresos</h4>
      <button (click)="exportarAExcel(logs, 'logs_ingresos')">ğŸ“ Exportar</button>
      <table>
        <thead>
          <tr>
            <th>Usuario</th>
            <th>Email</th>
            <th>Fecha y hora</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let log of logs">
            <td>{{ log.name }}</td>
            <td>{{ log.email }}</td>
            <td>{{ log.fecha | date: 'short' }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- TURNOS POR ESPECIALIDAD -->
    <div *ngIf="mostrarTurnosEspecialidad">
  <h4>ğŸ“ˆ Turnos por especialidad</h4>
  <table>
    <!-- GRÃFICO: Turnos por Especialidad -->
<div *ngIf="mostrarTurnosEspecialidad && turnosPorEspecialidad.length">
  <h4>ğŸ“Š GrÃ¡fico: Turnos por Especialidad</h4>
  <div style="display: flex; align-items: flex-end; gap: 8px; height: 200px;">
    <div *ngFor="let item of turnosPorEspecialidad" style="text-align: center;">
      <div
        [style.height.px]="item.count * 10"
        style="width: 40px; background: steelblue; color: white; display: flex; align-items: flex-end; justify-content: center;">
        {{ item.count }}
      </div>
      <div style="margin-top: 4px; font-size: 12px;">{{ item.especialidad }}</div>
    </div>
  </div>
</div>

    <thead>
      <tr>
        <th>Especialidad</th>
        <th>Cantidad</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let esp of turnosPorEspecialidad">
        <td>{{ esp.especialidad }}</td>
        <td>{{ esp.cantidad }}</td>
      </tr>
    </tbody>
  </table>
</div>


    <!-- TURNOS POR DÃA -->
   <div *ngIf="mostrarTurnosPorDia">
  <h4>ğŸ“… Turnos por DÃ­a</h4>
  <table>
    <!-- GRÃFICO: Turnos por DÃ­a -->
<div *ngIf="mostrarTurnosPorDia && turnosPorDia.length">
  <h4>ğŸ“ˆ Turnos por DÃ­a</h4>
  <svg width="600" height="300">
    <polyline
      [attr.points]="getLineaTurnosPorDia()"
      stroke="blue" stroke-width="2" fill="none" />
    <g *ngFor="let p of turnosPorDia; let i = index">
      <circle [attr.cx]="i * 60 + 30" [attr.cy]="300 - (p.cantidad * 10)" r="4" fill="red"></circle>
      <text [attr.x]="i * 60 + 20" y="290" font-size="10">{{ p.fecha | date:'dd/MM' }}</text>
    </g>
  </svg>
</div>

    <thead>
      <tr>
        <th>Fecha</th>
        <th>Cantidad</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of turnosPorDia">
        <td>{{ item.fecha }}</td>
        <td>{{ item.cantidad }}</td>
      </tr>
    </tbody>
  </table>
</div>


 <!-- Turnos por MÃ©dico -->
<div *ngIf="mostrarTurnosPorMedico">
  <h4>ğŸ‘¨â€âš•ï¸ Turnos por MÃ©dico</h4>
  <table>
    <tr>
      <th>MÃ©dico</th>
      <th>Cantidad</th>
    </tr>
    <tr *ngFor="let item of turnosPorMedico">
      <td>{{ item.medico }}</td>
      <td>{{ item.cantidad }}</td>
    </tr>
  </table>
</div>

    <!-- TURNOS FINALIZADOS POR MÃ‰DICO -->
    <!-- FINALIZADOS POR MÃ‰DICO -->
<div *ngIf="mostrarFinalizadosPorMedico">
  <h4>âœ… Turnos Finalizados por MÃ©dico</h4>
  <table>
    <thead>
      <tr>
        <th>MÃ©dico</th>
        <th>Cantidad</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let m of finalizadosPorMedico">
        <td>{{ m.medico }}</td>
        <td>{{ m.cantidad }}</td>
      </tr>
    </tbody>
  </table>
</div>


  <!-- EXPORTAR USUARIOS -->
  <button (click)="exportarUsuariosAExcel()" class="solicitar-turno-btn">ğŸ“ Exportar usuarios a Excel</button>

  <!-- SPINNER -->
  <div *ngIf="cargando">
    <img src="assets/informe.gif" alt="Cargando..." width="50" />
  </div>

  <!-- USUARIOS -->
  <div *ngIf="!cargando && usuarios.length">
    <div class="cards-container">
      <div *ngFor="let u of usuarios" class="card-usuario">
        <img [src]="u.avatarurl || 'assets/default-avatar.png'" class="avatar" />
        <div class="info-usuario">
          <p><strong>{{ u.nombre || u.name }} {{ u.apellido }}</strong></p>
          <p>{{ u.email }}</p>
          <p>{{ u.rol | titlecase }} - {{ u.estado ? 'Activo' : 'Inactivo' }}</p>
          <div class="acciones">
            <button *ngIf="u.rol === 'paciente'" (click)="descargarTurnosDelPaciente(u.authid)">ğŸ“¥ Turnos</button>
            <button *ngIf="u.rol === 'especialista'" (click)="alternarEstado(u)">
              {{ u.estado ? 'Inhabilitar' : 'Aprobar' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <button (click)="irATurnos()">Ver Turnos</button>

  <!-- CREAR ADMIN -->
  <hr />
  <h3>Crear Usuario Administrador</h3>
  <form (ngSubmit)="crearAdmin()" #formAdmin="ngForm">
    <input [(ngModel)]="nuevoAdmin.email" name="email" placeholder="Email" required />
    <input [(ngModel)]="nuevoAdmin.password" name="password" type="password" placeholder="ContraseÃ±a" required minlength="6" />
    <input [(ngModel)]="nuevoAdmin.nombre" name="nombre" placeholder="Nombre" required />
    <input [(ngModel)]="nuevoAdmin.apellido" name="apellido" placeholder="Apellido" required />
    <input [(ngModel)]="nuevoAdmin.edad" name="edad" type="number" placeholder="Edad" required min="0" />
    <input [(ngModel)]="nuevoAdmin.dni" name="dni" placeholder="DNI" required />
    <input type="file" (change)="seleccionarAvatar($event)" accept="image/*" />
    <button type="submit">Crear Admin</button>
  </form>

  <p *ngIf="error" class="error">{{ error }}</p>
  <p *ngIf="mensaje" class="success-message">{{ mensaje }}</p>
</div>
